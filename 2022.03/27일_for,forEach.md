# 2022. 03. 27 Today I Learned

## 잠은 오지만..

- 지금은 27일 오전 12시 18분입니다. 원래 12시~1시쯤 자고 오전 8시에 기상하는걸 목표로 살아가고 있는데, 정말 쉽지 않습니다. 나중에 출근 어떻게 하려고...

- 잠은 옵니다만, 자고싶지 않습니다.

---

## forEach()

- 콜백함수를 통해 배열을 돌다가 추가한 것은 반영하지 않지만, 삭제한 것은 반영함.

- 다만, 여기에서 수상한 점이 하나 있습니다.

```js
let list = [0, 1, 2];
let test = function (el, index, all) {
  if (index === 0) {
    list.push(3);
  }
  console.log(el);
};

list.forEach(test); // 0 1 2
console.log(list); // [0, 1, 2, 3]
```

- 이 코드의 결과값은 0 1 2가 순차적으로 나옵니다. 즉, 콜백함수 안의 `push` 가 제대로 작동하지 않았다는 거겠죠.

- 혹여 `push` 라는 명령어 자체가 작동하지 않았을까봐 콘솔로 리스트를 찍어봤지만, 정상적으로 작동한 모습을 보여줍니다.

  - 그러나 이걸 조금만 바꾸면

```js
let list = [0, 1, 2];
let test = function (el, index, all) {
  if (index === 0) {
    list[2] = 3;
    list[3] = 4;
  }
  console.log(el);
};

list.forEach(test); // 0 1 3
console.log(list); // [0, 1, 3, 4]
```

- 이런 수상한 결과가 나오는 것을 알 수 있습니다. 즉, 추가는 반영되지 않지만, 수정은 반영되는걸 볼 수 있습니다.

  - 2번 인덱스를 수정하는 코드는 작동했지만, 3번 인덱스에 새로운 배열을 추가하는 코드는 작동하긴 했으나 `forEach()` 함수에서는 작동하지 않았습니다.

- 이외에도 삭제하는 코드도 정상적으로 작동한다고 합니다.

- 즉, 새로운 배열을 추가하는 것만 `forEach()` 에서 작동하지 않는다는건데,

  - 음.. 이왕이면 일관성있게 될거면 다 되게 해주던가, 안될거면 다 안되게 해주는게 낫지 않았을까요? 설계상 미처 생각하지 못한 부분인건지, 아니면 제가 미처 생각하지 못한 부분을 개발자들은 생각해내서 일부러 이렇게 만든건지 궁금합니다.

- `for` 와 `forEach()` 의 차이

  - `for` 의 경우 for문 안에 적혀있는 함수를 직접 읽어봐야 이 함수가 어떤 작용을 하는지 알 수 있습니다.

    - 물론 함수의 이름으로도 그 기능을 짐작해볼 수 있겠지만, 음... 일단 그렇다고 칩시다.

- 그러나 여기서 `forEach()` 가 상대적으로 갖는 장점이 있습니다. 시맨틱적인 장점인데요,

  - 첫째로 처음부터 끝까지 반복할 것이라는 의미.

  - 둘째로 반복하는동안 끝나지 않을 것이라는 의미.

  - 이렇게 두 가지 의미를 `forEach()` 는 기본적으로 가지고 있습니다.

  - 이외에 `forEach()` 는 시작 인덱스를 조절할수도 없는데, 이것 또한 `for` 와 비교해서 가지는 차이점 중 하나라고 생각합니다.

- "프로그램은 코드가 아닌 시나리오로 풉니다"

---

- 강사님께서 코딩과제를 하나 내주셨습니다.

- 배열에 1부터 1,000,000까지 작성

- 빈 함수인 `check()` 생성 후 `forEach()` 로 배열을 돌 때 마다 `check()` 함수 호출

- 백만 번의 함수를 호출하는데 걸리는 시간 측정하기

- 음... 머리속에 코드가 잘 안그려지는데요. 일단 배열에 1부터 백만까지 적는다는 것 부터가 수작업으로는 불가능합니다.

  - 시간을 측정하는 방법은 `Date.now()` 라는 함수를 강사님께서 가르쳐주셨습니다.

  - 일단 한번 써보기나 하죠.

```js
let arr = [];

for (i = 1; i <= 1000000; i++) {
  arr[i - 1] = i;
}

console.log(arr);
```

- 일단 1,000,000까지 배열이 잘 생성되었는지 확인하기 위해 콘솔을 하나 찍어봤습니다. 잘 만들어진 것 같네요.

---

```js
// 빈 배열인 arr과 빈 함수인 check() 선언
let arr = [];
function check() {}

// 배열 속에 백만개의 요소를 만들기 위한 함수
for (let i = 1; i <= 1000000; i++) {
  arr[i - 1] = i;
}

// forEach()를 사용해 배열의 수만큼 빈 함수를 호출하기 위해 만든 함수
let test = function () {
  check();
};

// 시작시간 측정, 함수 백만번 호출, 종료시간 측정
let start = Date.now();
arr.forEach(test);
let end = Date.now();

// 최종적으로 걸린 시간 측정, 결과 출력
console.log(end - start);
```

- ㅇㅓ... 아직 `forEach()` 에 익숙하지 않아서, 이렇게 하는게 맞는건지 모르겠습니다.

- 이렇게 코드를 짜고, 여러번 실행버튼을 눌러보니 8 혹은 9가 나옵니다.

- 밀리초 단위로 결과가 나온 것일테니 구글에 가서 환산을 한번 해보면?

  - 8은 0.008초, 9는 0.009초입니다.

  - 백만개의 함수를 호출하는데 1초도 안걸린단 소리군요. 0.1초를 넘어 0.01초도 안걸린다니.. 역시 계산은 컴퓨터가 참 빠르네요.

  - 강사님께서 함수를 여러개 만들어도 웬만해서 컴퓨터에는 무리가 없다는 것을 알게 하기위해 이 문제를 만드셨다고 합니다.

- 강사님께서는 이 코드가 맞는지 확인하기 위해 코드를 만드는 것도 경험의 한 과정이라고 하는데...

  - 이 코드가 문제의 의도와 적절한 코드인지를 확인하는 방법은 무엇이지요..?

  - 적어도 거기에 대해 힌트라도 주셨으면 좋았을텐데, 아쉽습니다ㅜㅜ
